code: arvr_ar_script
guiCode: "\r\n<script >\r\nwindow.onload = () => {\r\n\r\n    function getPois() {\r\n\r\n        const options = {\r\n            method: 'get',\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"i-edx-token\": \"554c8ffbe6a574c33680fb594ab8c0952b54d9301fc941a34ba27434cfd8cbca\",\r\n            }\r\n        };\r\n\r\n        fetch('https://i-edx.k8s-entando.org/jangalian/accesscode/0-0-1-snapshot/api/pois', options)\r\n            .then((response) => {\r\n                return response.json();\r\n            })\r\n            .then((data) => {\r\n                let pois = data;\r\n                console.log(\"POIS\", pois);\r\n                return pois;\r\n            })\r\n\r\n    }\r\n\r\n\r\n    let method = 'dynamic';\r\n    // de-comment following line for static places\r\n    method = 'static';\r\n\r\n    if (method === 'static') {\r\n        //getPois();\r\n        let places = getPois();\r\n        //let places = staticLoadPlaces();\r\n        renderPlaces(places);\r\n        console.log(places);\r\n\r\n    }\r\n\r\n    if (method !== 'static') {\r\n\r\n        // first get current user location\r\n        return navigator.geolocation.getCurrentPosition(function(position) {\r\n\r\n                // than use it to load from remote APIs some places nearby\r\n                dynamicLoadPlaces(position.coords)\r\n                    .then((places) => {\r\n                        renderPlaces(places);\r\n                    })\r\n            },\r\n            (err) => console.error('Error in retrieving position', err), {\r\n                enableHighAccuracy: true,\r\n                maximumAge: 0,\r\n                timeout: 27000,\r\n            }\r\n        );\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\nfunction staticLoadPlaces() {\r\n    return [{\r\n            name: 'Questo Ã¨ il palazzo Pazze ',\r\n            link: 'https://dminnai.github.io/artest/test.html',\r\n            info: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',\r\n            src: 'assets/asset.png',\r\n            location: {\r\n                lat: 39.169192,\r\n                lng: 8.526058,\r\n            }\r\n        },\r\n        {\r\n            name: 'Laboratorio analisi ',\r\n            link: 'https://dminnai.github.io/artest/test.html',\r\n            info: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',\r\n            src: 'assets/Vector.png',\r\n            location: {\r\n                lat: 39.169377,\r\n                lng: 8.524878,\r\n            }\r\n        },\r\n        {\r\n            name: 'Parcheggio Davide',\r\n            link: 'https://dminnai.github.io/artest/test.html',\r\n            info: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',\r\n            src: 'assets/Vector.png',\r\n            location: {\r\n                lat: 39.169307,\r\n                lng: 8.525570,\r\n            }\r\n        },\r\n    ];\r\n}\r\n\r\n\r\n\r\nfunction renderPlaces(places) {\r\n    let scene = document.querySelector('a-scene');\r\n    console.log(\"places\", places);\r\n    places?.forEach((place) => {\r\n        console.log(\"dentro\");\r\n\r\n        const latitude = place.location.lat;\r\n        const longitude = place.location.lng;\r\n\r\n\r\n        // add place icon\r\n        const icon = document.createElement('a-image');\r\n        icon.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);\r\n        icon.setAttribute('name', place.name);\r\n        icon.setAttribute('src', place.src);\r\n        icon.setAttribute('href', place.link);\r\n        icon.setAttribute('info', place.info);\r\n        icon.setAttribute('width', '2');\r\n        icon.setAttribute('height', '2');\r\n        icon.setAttribute('look-at', '[gps-camera]');\r\n\r\n        // for debug purposes dimension are bigger\r\n        icon.setAttribute('scale', '7, 7');\r\n\r\n        // icon.addEventListener('loaded', () => window.dispatchEvent(new CustomEvent('gps-entity-place-loaded')));\r\n        icon.addEventListener('loaded', () => {\r\n            window.dispatchEvent(new CustomEvent('gps-entity-place-loaded', {\r\n                detail: {\r\n                    component: this.el\r\n                }\r\n            }))\r\n        });\r\n\r\n        const clickListener = function(ev) {\r\n            ev.stopPropagation();\r\n            ev.preventDefault();\r\n            console.log(\"target\", ev.target);\r\n            if (document.contains(document.getElementById('place-label'))) {\r\n                document.getElementById('place-label').remove();\r\n            }\r\n            if (document.getElementById('modal-body').innerHTML.trim() != '') {\r\n                alert(\"pieno\");\r\n                document.getElementById('modal-title').innerHTML = \"\";\r\n                document.getElementById('modal-body').innerHTML = \"\";\r\n                document.getElementById('modal-link').innerHTML = \"\";\r\n            }\r\n\r\n            const name = ev.target.getAttribute('name');\r\n            const link = ev.target.getAttribute('href');\r\n            const info = ev.target.getAttribute('info');\r\n\r\n            const el = ev.detail.intersection && ev.detail.intersection.object.el;\r\n\r\n            if (el && el === ev.target) {\r\n\r\n                //create button modal\r\n                const button = document.createElement('button');\r\n                button.setAttribute('id', 'modal-btn');\r\n                button.innerText = \"approfondisci\";\r\n\r\n                const label = document.createElement('span');\r\n\r\n                const container = document.createElement('div');\r\n                container.setAttribute('id', 'place-label');\r\n\r\n                const poiLink = document.createElement('a');\r\n                poiLink.setAttribute('id', 'place-link');\r\n                poiLink.setAttribute('href', link);\r\n\r\n                // place contents on modal\r\n                document.getElementById('modal-title').textContent += name;\r\n                document.getElementById('modal-body').textContent += info;\r\n                document.getElementById('modal-link').appendChild(poiLink);\r\n\r\n                label.innerText = name;\r\n                poiLink.innerText = \"Approfondisci\";\r\n\r\n                container.appendChild(label);\r\n                // container.appendChild(poiLink);\r\n                container.appendChild(button);\r\n\r\n                document.body.appendChild(container);\r\n\r\n                // create variables for modal\r\n                const modal = document.getElementById(\"modal-info\");\r\n                const span = document.getElementsByClassName(\"close\")[0];\r\n\r\n                const modalContainer = document.getElementById(\"modal-container\");\r\n\r\n                //set onclick\r\n                button.onclick = function() {\r\n                    modalContainer.removeAttribute(\"class\")\r\n                    modalContainer.classList.add(\"one\");\r\n                    document.body.classList.add(\"modal-active\");\r\n\r\n                }\r\n                span.onclick = function() {\r\n                    modalContainer.classList.add(\"out\");\r\n                    document.body.classList.remove(\"modal-active\");\r\n\r\n                }\r\n                window.onclick = function(event) {\r\n                    if (event.target == modal) {\r\n                        modalContainer.classList.add(\"out\");\r\n                        document.body.classList.remove(\"modal-active\");\r\n                    }\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    container.parentElement.removeChild(container);\r\n                }, 9999500);\r\n            }\r\n        };\r\n\r\n        icon.addEventListener('click', clickListener);\r\n\r\n        scene.appendChild(icon);\r\n    });\r\n}\r\n</script>\r\n"
